<!doctype html>
<html lang="en">
<head>
    <title>Stripe Connect</title>
	%= include 'site/head'
	%= include 'mixpanel'
  
    <!-- record main page view -->
  	<script type="text/javascript">mixpanel.track('view-admin-stripe-connect-page')</script>
</head>

<body>
	%= include 'admin/header'

    <div class="container">
    
        <div class="row">
        	    	
	    	<div class="col-xs-12 col-sm-8 col-md-9 col-lg-10">
                
                <div class="row" style="margin-top: 20px">
                    <div class="col-xs-12">

                        <b>Active Stripe Account:</b> <div class="btn-group" id="connect-switch"></div>

                        <div class="panel panel-default">
                            <!-- Default panel contents -->
                            <div class="panel-heading">
                                <a data-toggle="collapse" data-target="#help">
                                    <div style="color: #333; font-weight: bold">
                                        Stripe Invoices
                                    </div>
                                </a>
                            </div>                        
                            <div class="list-group collapse in" id="help">
                                <a href="#connect" class="list-group-item">
                                    <h4 class="list-group-item-heading">Connect</h4>
                                    <p class="list-group-item-text">Connect PDFUnicorn to your Stripe live or test account.</p>
                                </a>
                                <a href="#customer" class="list-group-item">
                                    <h4 class="list-group-item-heading">Customer Lookup</h4>
                                    <p class="list-group-item-text">Look up a customer's invoices and preview or download their invoice as a PDF generated using your selected template.</p>
                                </a>
                                <a href="#template-select" class="list-group-item">
                                    <h4 class="list-group-item-heading">Template Selector</h4>
                                    <p class="list-group-item-text">Select a template to use for generating your customers' invoices.</p>
                                </a>
                                <a href="#templates" class="list-group-item">
                                    <h4 class="list-group-item-heading">Template Editor</h4>
                                    <p class="list-group-item-text">Create and edit your templates.</p>
                                </a>
                                <a href="#template-lib" class="list-group-item">
                                    <h4 class="list-group-item-heading">Template Library</h4>
                                    <p class="list-group-item-text">Public templates which you can preview and import into your account.</p>
                                </a>
                            </div>                
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xs-12">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" id="myTabs">
                          <li class="active"><a href="#connect" data-toggle="tab">Connect</a></li>
                          <li><a href="#customer" data-toggle="tab">Customer Lookup</a></li>
                          <li><a href="#template-select" data-toggle="tab">Template Selector</a></li>
                          <li><a href="#templates" data-toggle="tab">Template Editor</a></li>
                          <li><a href="#template-lib" data-toggle="tab">Template Library</a></li>
                        </ul>
                        
                        <!-- Tab panes -->
                        <div class="tab-content">
                        
                            <div class="tab-pane in active" id="connect">
                                <h4>Connect PDFUnicorn to your Stripe live or test account.</h4>
                                % if ($error){
                                    <div class="alert alert-danger"><%= $error %></div>
                                % }
                                
                                <div id="connect-clients">
                                    <p>Live Stripe Account: <span id="live-connect"></span></p>
                                    <p>Test Stripe Account: <span id="test-connect"></span></p>
                                </div>
                            </div>
        
                            <div class="tab-pane" id="customer">
                                <h4>Enter your customer's Stripe ID to view their current invoices.</h4>
                                <div id="customer-lookup">
                                    <form id="customer-lookup-form" role="form" class="form-inline">
                                        <div class="form-group">
                                            <label class="sr-only" for="customer_id">Customer ID</label>
                                            <input type="text" class="form-control" id="customer_id" placeholder="Customer ID">
                                        </div>
                                        <button class="btn btn-default">Display</button>
                                    </form>
                                    <div id="customer-view"></div>
                                </div>
                            </div>
        
                            <div class="tab-pane" id="template-select">
                                <h4>Select one of your templates to use to generate your invoices.</h4>
                                <div id="template-selector-layout" class="row">
                                    <div id="template-selected" class="col-xs-12" style="margin-top: 10px"></div>
                                    <div id="template-list" class="col-xs-12"></div>
                                </div>
                            </div>
        
                            <div class="tab-pane" id="templates">
                                <h4>Create and edit your templates.</h4>
                                <div id="template-editor-layout" class="row">
                                    <div id="template-list" class="col-xs-12 col-sm-3" style="margin-top: 10px; padding-left:0px; padding-right:0px"></div>
                                    <div id="template-editor" class="col-xs-12 col-sm-9" style="margin-top: 10px; padding-left:10px; padding-right:0px"></div>
                                </div>
                            </div>
        
                            <div class="tab-pane" id="template-lib">
                                <h4>Public templates which you can preview and import into your account.</h4>
                                <div id="template-library-layout" class="row">
                                    <div id="template-list" class="col-xs-12 col-sm-3" style="margin-top: 10px; padding-left:0px; padding-right:0px""></div>
                                    <div id="template-editor" class="col-xs-12 col-sm-9" style="margin-top: 10px; padding-left:10px; padding-right:0px"></div>
                                </div>
                            </div>
        
                        </div>
                
                    </div>
                </div>
            </div>


    	
    	</div>
    </div>
    
    %= include 'admin/foot'

    <div style="display: none" id="connected-test">
        <p>Your PDFUnicorn account and <b>test</b> Stripe account are connected.</p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your live Stripe account</a></p>
    </div>

    <div style="display: none" id="connected-not">
        <p>Your PDFUnicorn account is not connected to a Stripe account.</p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{test_client_id} %>">Connect with your <b>test</b> Stripe account</a></p>
    </div>


    <script id="connect-switch-item-tmpl" type="template">
        <label class="btn btn-primary btn-sm" id="connect-switch-{%= name %}" style="margin-bottom: 8px">
            <input type="radio" style="display:none" id="connect-switch-{%= name %}-btn" name="{%= name %}"> {%= label %}
        </label>
    </script>
    
    <script id="customer-tmpl" type="template">
        <div id="section">
            <div id="{%= id %}" class="customer-view">
                <div class="detail-container">
                    <div class="section clearfix">
                        <!-- Content -->
                        <div class="content">
                            <div class="gradient"></div>
                            <!-- Details -->
                            <div class="section-wrap">
                                <h4>Customer Details</h4>
                                <div class="container">
                                    <dl class="dl-horizontal" style="margin-bottom: 0px;">
                                        <dt>ID:</dt>
                                        <dd>{%= id %}</dd>
                                        
                                        <dt>Email:</dt>
                                        <dd class="edit_details">{%= email %}</dd>
                
                                        <dt>Description:</dt>
                                        <dd class="edit_details"><em>{%= description %}</em></dd>
                                    </dl>
                                </div>
                                <h4>Default Card Details</h4>
                                <div class="container">
                                    <dl class="dl-horizontal" style="margin-bottom: 0px;">
                                        <dt>Name:</dt>
                                        <dd class="edit_details">{%= card.name %}</dd>
                
                                        <dt>Address:</dt>
                                        <dd class="edit_details">
                                            <p>
                                                {%= card.address_line1 %}<br />
                                                {% if (card.address_line2){ %}{%= card.address_line2 %}<br />{% } %}
                                                {%= card.address_city %},
                                                {%= card.address_state %},
                                                {%= card.address_zip %},
                                                {%= card.address_country %}
                                            </p>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
            
                            <!-- Invoices -->
                            <div class="section-wrap" id="customer-invoices">
                                <h4>Invoices</h4>
                                <div class="container invoices sublist">
                        
                                    <!-- Loading state -->
                                    <div class="loading" style="display: none;">
                                      <em class="empty-container">Loading invoice information...</em>
                                    </div>
                        
                                    <!-- There are invoices -->
                                    <div class="many">
                                        <ul>
                                            {% _.each(invoices.data, function(invoice) { %}
                                                <li>
                                                    <a data-model-id="{%= invoice.id %}" href="/test/invoices/{%= invoice.id %}" class="unpaid">
                                                        <span class="date">{%= invoice.date %}</span>
                                                        <strong>${%= invoice.amount_due %}</strong>
                                                    </a>
                                                    <ul>
                                                        {% _.each(invoice.lines.data, function(line){ %}
                                                            <li>
                                                                <b>Plan: </b>{%= line.plan.name %} @ ${%= line.plan.amount %}
                                                            </li>
                                                        {% }); %}
                                                    </ul>
                                                </li>
                                            {% }); %}
                                        </ul>
                        
                                        <p class="more" style="display: none;">
                                            <a href="/test/invoices?customer={%= id %}">
                                                View more invoices
                                            </a>
                                        </p>
                                    </div>
                        
                                    <!-- No invoices -->
                                    <div class="none" style="display: none;">
                                        <em class="empty-container">No invoices</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        
    </script>

    <script id="template-liblist-tmpl" type="template">
        <div class="well">
            <div class="row">
                <div class="col-xs-12">
                    <ul id="template-list-items" class="nav nav-pills nav-stacked"></ul>
                </div>
            </div>
        </div>
    </script>

    <script id="template-editorlist-tmpl" type="template">
        <div class="well">
            <div class="row" style="margin-bottom: 10px">
                <div class="col-xs-12">
                    <button type="button" id="new-button" class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-plus"></span> Create a new template
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <ul id="template-list-items" class="nav nav-pills nav-stacked"></ul>
                </div>
            </div>
        </div>
    </script>

    <script id="template-list-item-tmpl" type="template">
        <li class="template-list-name">
            <a href="#">{%= name %}<span style="display:none" class=" pull-right glyphicon glyphicon-trash trash"></span></a>
        </li>
    </script>

    <script id="template-selectlist-tmpl" type="template">
        <div class="well" id="template-selectlist-items">
        </div>
    </script>

    <script id="template-selector-item-tmpl" type="template">
        <div class="row" style="margin-bottom: 5px">
            <div class="col-xs-3 col-sm-2 col-md-2">
                <a href="#" class="btn btn-primary">Select</a>
            </div>
            <div class="col-xs-9 col-sm-10 col-md-3">{%= name %}</div>
            <div class="col-xs-offset-3 col-xs-9 col-sm-offset-2 col-sm-10 col-md-offset-0 col-md-7">{%= description %}</div>
        </div>
    </script>

    <script id="template-selected-tmpl" type="template">
        <div class="well" style="padding:5px">
            <strong>Current Template:</strong>
            <div class="row">
                <div class="col-xs-2">
                    {%= name %}
                </div>
                <div class="col-xs-10">
                    {%= description %}
                </div>
            </div>
        </div>
    </script>

    <script id="template-library-tmpl" type="template">
        <div class="well">
            <div class="row" style="height: 30px">
                <div id="editor-name" class="col-xs-12 col-sm-6" style="margin:5px 0"></div>
            </div>
            <div class="row" style="margin-top: 10px; margin-bottom: 10px;">
                <div id="template-description" class="col-xs-12"></div>
            </div>
            <div class="row" style="height: 30px; margin-top: 10px; margin-bottom: 10px;">
                <div class="col-xs-6 col-lg-4" style="margin:5px 0">
                    <ul class="nav nav-pills">
                        <li id="source-item"><a href="#" id="source-pill">Source</a></li>
                        <li id="sample_data-item"><a href="#" id="data-pill">Sample Data</a></li>
                    </ul>
                </div>
                <div class="col-xs-6 col-lg-4 pull-right" style="margin:5px 0">
                    <form class="form-inline" role="form">
                        <button type="button" id="import-button" class="btn btn-default btn-sm pull-right" style="margin-left: 5px">
                            <span class="glyphicon glyphicon-import saved"></span> Import
                        </button>
                        <button type="button" id="preview-button" class="btn btn-default btn-sm pull-right" style="margin-left: 5px">
                            <span class="glyphicon glyphicon-save"></span> Preview
                        </button>
                    </form>
                </div>
            </div>
            <div class="row">
                <div id="editor-content"></div>
            </div>
            <form id="editorPreview" action="/admin/preview" method="post" target="_blank">
                <input type="hidden" name="template" />
                <input type="hidden" name="data" />
            </form>        
        </div>
    </script>

    <script id="template-editor-tmpl" type="template">
        <div class="well">
            <div class="row" style="height: 30px">
                <div id="editor-name" class="col-xs-12 col-sm-6" style="margin:5px 0"></div>
                <div id="template-options" class="col-xs-12 col-sm-6" style="margin:5px 0">
                    <div class="btn-group pull-right">
                        <label class="btn btn-primary" id="editor-private">
                            <input type="radio" style="display:none" id="editor-private-btn" name="public" value="false"> Private
                        </label>
                        <label class="btn btn-primary" id="editor-public">
                            <input type="radio" style="display:none" id="editor-public-btn" name="public" value="true"> Public
                        </label>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-top: 10px; margin-bottom: 10px;">
                <div id="template-description" class="col-xs-12"></div>
            </div>
            <div class="row" style="height: 30px; margin-top: 10px; margin-bottom: 10px;">
                <div class="col-xs-6 col-lg-4" style="margin:5px 0">
                    <ul class="nav nav-pills">
                        <li id="source-item"><a href="#" id="source-pill">Source</a></li>
                        <li id="sample_data-item"><a href="#" id="data-pill">Sample Data</a></li>
                    </ul>
                </div>
                <div class="col-xs-6 col-lg-4 pull-right" style="margin:5px 0">
                    <form class="form-inline" role="form">
                        <button type="button" id="save-button" disabled="disabled" class="btn btn-default btn-sm pull-right" style="margin-left: 5px">
                            <span style="display:none" class="glyphicon glyphicon-save save"></span><span class="glyphicon glyphicon-saved saved"></span> Save
                        </button>
                        <button type="button" id="preview-button" class="btn btn-default btn-sm pull-right" style="margin-left: 5px">
                            <span class="glyphicon glyphicon-save"></span> Preview
                        </button>
                    </form>
                </div>
            </div>
            <div class="row">
                <div id="editor-content"></div>
            </div>
            <form id="editorPreview" action="/admin/preview" method="post" target="_blank">
                <input type="hidden" name="template" />
                <input type="hidden" name="data" />
            </form>        
        </div>
    </script>

    <script id="template-editor-name-tmpl" type="template">
        <div><a id="editor-name-link" href="#" style="text-decoration:none; color:black"><h4 id="editor-template-name" style="margin-top: 2px; margin-bottom: 2px">{%= name %}</h4></a></div>
    </script>
    
    <script id="template-editor-name-edit-tmpl" type="template">
        <div><input type="text" class="form-control" value="{%= name %}"></div>
    </script>
    
    <script id="template-editor-description-tmpl" type="template">
        <div><a id="template-description-link" href="#" style="text-decoration:none; color:black"><span id="editor-template-description" style="margin-top: 2px; margin-bottom: 2px">{%= description %}</span></a></div>
    </script>

    <script id="template-editor-description-edit-tmpl" type="template">
        <div><textarea class="form-control" rows="3">{%= description %}</textarea></div>
    </script>

    <script id="template-editor-content-source-tmpl" type="template">
        <div><textarea class="form-control" rows="15">{%= source %}</textarea></div>
    </script>

    <script id="template-editor-content-data-tmpl" type="template">
        <div><textarea class="form-control" rows="15">{%= sample_data %}</textarea></div>
    </script>

    <script id="template-editor-content-preview-tmpl" type="template">
    </script>
    
</body>
</html>
