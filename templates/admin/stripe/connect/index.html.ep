<!doctype html>
<html lang="en">
<head>
    <title>Stripe Connect</title>
	%= include 'site/head'
	%= include 'mixpanel'
  
    <!-- record main page view -->
  	<script type="text/javascript">mixpanel.track('view-admin-stripe-connect-page')</script>
</head>

<body>
	%= include 'site/header'

    <div class="container">
    
        <div class="row row-offcanvas row-offcanvas-left">
        
	    	%= include 'admin/side_nav'   
	    
	    	<div class="col-xs-12 col-sm-9">
                <h2>Stripe Connect</h2>
                
                % if ($error){
                    <div class="alert alert-danger"><%= $error %></div>
                % }
                
                <div id="account-connected">
                % if ($stripe_client){
                    % if ($stripe_client->{livemode}){
                        <p>Your PDFUnicorn account and <b>live</b> Stripe account are connected.</p>
                    % } else {
                        <p>Your PDFUnicorn account and <b>test</b> Stripe account are connected.</p>
                        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
                    % }                    
                % } else {
                    <p>Your PDFUnicorn account is not connected to a Stripe account.</p>
    	    		<p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
                    <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{test_client_id} %>">Connect with your <b>test</b> Stripe account</a></p>
                % }
                </div>
            </div>
    	
            <div class="col-xs-12">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs">
                  <li class="active"><a href="#customer" data-toggle="tab">Customer</a></li>
                  <li><a href="#templates" data-toggle="tab">Templates</a></li>
                </ul>
                
                <!-- Tab panes -->
                <div class="tab-content">
                
                    <div class="tab-pane in active" id="customer">
                        <h2>Customer Lookup</h2>
                        <div id="customer-lookup">
                            <form id="customer-lookup-form" role="form" class="form-inline">
                                <div class="form-group">
                                    <label class="sr-only" for="customer_id">Customer ID</label>
                                    <input type="text" class="form-control" id="customer_id" placeholder="Customer ID">
                                </div>
                                <button class="btn btn-default">Display</button>
                            </form>
                            <div id="customer-view">
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane" id="templates">
                        <div id="template-editor-layout">
                            <div id="template-list" class="col-xs-12 col-sm-3" style="margin-top: 10px">
                            </div>
                            <div id="template-editor" class="col-xs-12 col-sm-9">
                            </div>
                        </div>
                    </div>

                </div>
            </div>
    	</div>
    </div>
    
    %= include 'site/foot'

    <div style="display: none" id="connected-test">
        <p>Your PDFUnicorn account and <b>test</b> Stripe account are connected.</p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your live Stripe account</a></p>
    </div>

    <div style="display: none" id="connected-not">
        <p>Your PDFUnicorn account is not connected to a Stripe account.</p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{test_client_id} %>">Connect with your <b>test</b> Stripe account</a></p>
    </div>

    <script id="customer-tmpl" type="template">
        <div id="section">
            <div id="{%= id %}" class="customer-view">
                <div class="detail-container">
                    <div class="section clearfix">
                        <!-- Content -->
                        <div class="content">
                            <div class="gradient"></div>
                            <!-- Details -->
                            <div class="section-wrap">
                                <h4>Customer Details</h4>
                                <div class="container">
                                    <dl class="dl-horizontal">
                                        <dt>ID:</dt>
                                        <dd>{%= id %}</dd>
                                        
                                        <dt>Email:</dt>
                                        <dd class="edit_details">{%= email %}</dd>
                
                                        <dt>Description:</dt>
                                        <dd class="edit_details"><em>{%= description %}</em></dd>

                                </div>
                                <h4>Default Card Details</h4>
                                <div class="container">
                                    <dl class="dl-horizontal">
                                        <dt>Name:</dt>
                                        <dd class="edit_details">{%= card.name %}</dd>
                
                                        <dt>Address:</dt>
                                        <dd class="edit_details">
                                            <p>
                                                {%= card.address_line1 %}<br />
                                                {% if (card.address_line2){ %}{%= card.address_line2 %}<br />{% } %}
                                                {%= card.address_city %},
                                                {%= card.address_state %},
                                                {%= card.address_zip %},
                                                {%= card.address_country %}
                                            </p>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
            
                            <!-- Invoices -->
                            <div class="section-wrap" id="customer-invoices">
                                <h4>Invoices</h4>
                                <div class="container invoices sublist">
                        
                                    <!-- Loading state -->
                                    <div class="loading" style="display: none;">
                                      <em class="empty-container">Loading invoice information...</em>
                                    </div>
                        
                                    <!-- There are invoices -->
                                    <div class="many">
                                        <ul>
                                            {% _.each(invoices.data, function(invoice) { %}
                                                <li>
                                                    <a data-model-id="{%= invoice.id %}" href="/test/invoices/{%= invoice.id %}" class="unpaid">
                                                        <span class="date">{%= invoice.date %}</span>
                                                        <strong>${%= invoice.amount_due %}</strong>
                                                    </a>
                                                    <ul>
                                                        {% _.each(invoice.lines.data, function(line){ %}
                                                            <li>
                                                                <b>Plan: </b>{%= line.plan.name %} @ ${%= line.plan.amount %}
                                                            </li>
                                                        {% }); %}
                                                    </ul>
                                                </li>
                                            {% }); %}
                                        </ul>
                        
                                        <p class="more" style="display: none;">
                                            <a href="/test/invoices?customer={%= id %}">
                                                View more invoices
                                            </a>
                                        </p>
                                    </div>
                        
                                    <!-- No invoices -->
                                    <div class="none" style="display: none;">
                                        <em class="empty-container">No invoices</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        
    </script>

    <script id="template-list-tmpl" type="template">
        <div>
            <div class="row" style="margin-bottom: 10px">
                <div class="col-xs-12">
                    <button type="button" id="new-button" class="btn btn-default btn-xs">
                        <span class="glyphicon glyphicon-plus"></span> New
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <ul id="template-list-items" class="nav nav-pills nav-stacked"></ul>
                </div>
            </div>
        </div>
    </script>

    <script id="template-list-item-tmpl" type="template">
        <li class="template-list-name">
            <a href="#">{%= name %}<span style="display:none" class=" pull-right glyphicon glyphicon-trash trash"></span></a>
        </li>
    </script>

    <script id="template-editor-tmpl" type="template">
        <div>
            <div class="row" style="height: 30px; margin-top: 10px; margin-bottom: 10px;">
                <div id="editor-name" class="col-xs-12 col-sm-12 col-md-5"></div>
                <div class="col-xs-12 col-sm-10 col-md-5">
                    <ul class="nav nav-pills">
                        <li id="source-item"><a href="#" id="source-pill">Source</a></li>
                        <li id="sample_data-item"><a href="#" id="data-pill">Sample Data</a></li>
                        <li id="preview-item"><a href="#" id="preview-pill">Preview</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-2 col-md-2">
                    <form class="form-inline" role="form">
                        <button type="button" id="save-button" disabled="disabled" class="btn btn-default btn-sm pull-right" style="margin-left: 5px">
                            <span style="display:none" class="glyphicon glyphicon-save save"></span><span class="glyphicon glyphicon-saved saved"></span> Save
                        </button>
                    </form>
                </div>
            </div>
            <div class="row">
                <div id="editor-content"></div>
            </div>
        </div>
    </script>

    <script id="template-editor-name-tmpl" type="template">
        <div><a id="editor-name-link" href="#" style="text-decoration:none; color:black"><h4 id="editor-template-name" style="margin-top: 2px; margin-bottom: 2px">{%= name %}</h4></a></div>
    </script>
    
    <script id="template-editor-name-edit-tmpl" type="template">
        <div><input type="text" class="form-control" value="{%= name %}"></div>
    </script>
    
    <script id="template-editor-content-source-tmpl" type="template">
        <div><textarea class="form-control" rows="15">{%= source %}</textarea></div>
    </script>

    <script id="template-editor-content-data-tmpl" type="template">
        <div><textarea class="form-control" rows="15">{%= sample_data %}</textarea></div>
    </script>

    <script id="template-editor-content-preview-tmpl" type="template">
    </script>

</body>
</html>
