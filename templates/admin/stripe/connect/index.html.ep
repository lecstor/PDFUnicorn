<!doctype html>
<html lang="en">
<head>
    <title>Stripe Connect</title>
	%= include 'site/head'
	%= include 'mixpanel'
  
    <!-- record main page view -->
  	<script type="text/javascript">mixpanel.track('view-admin-stripe-connect-page')</script>
</head>

<body>
	%= include 'site/header'

    <div class="container">
    
        <div class="row row-offcanvas row-offcanvas-left">
        
	    	%= include 'admin/side_nav'   
	    
	    	<div class="col-xs-12 col-sm-9">
                <h2>Stripe Connect</h2>
                
                % if ($error){
                    <div class="alert alert-danger"><%= $error %></div>
                % }
                
                <div id="account-connected">
                % if ($stripe_client){
                    % if ($stripe_client->{livemode}){
                        <p>Your PDFUnicorn account and <b>live</b> Stripe account are connected.</p>
                    % } else {
                        <p>Your PDFUnicorn account and <b>test</b> Stripe account are connected.</p>
                        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
                    % }                    
                % } else {
                    <p>Your PDFUnicorn account is not connected to a Stripe account.</p>
    	    		<p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
                    <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{test_client_id} %>">Connect with your <b>test</b> Stripe account</a></p>
                % }
                </div>
            </div>
    	
            <div class="col-xs-12 col-sm-9">
                <h2>Customer Lookup</h2>

                <div id="customer-lookup">
                    <form id="customer-lookup-form" role="form" class="form-inline">
                        <div class="form-group">
                            <label class="sr-only" for="customer_id">Customer ID</label>
                            <input type="text" class="form-control" id="customer_id" placeholder="Customer ID">
                        </div>
                        <button class="btn btn-default">Display</button>
                    </form>
                    <div id="customer-view">
                    </div>
                </div>
            </div>
    	</div>
    </div>
    
    %= include 'site/foot'

    <div style="display: none" id="connected-test">
        <p>Your PDFUnicorn account and <b>test</b> Stripe account are connected.</p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your live Stripe account</a></p>
    </div>

    <div style="display: none" id="connected-not">
        <p>Your PDFUnicorn account is not connected to a Stripe account.</p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{client_id} %>">Connect with your <b>live</b> Stripe account</a></p>
        <p><a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=<%= config->{stripe}{test_client_id} %>">Connect with your <b>test</b> Stripe account</a></p>
    </div>



    <script id="customer-tmpl" type="template">
        <div id="section">
            <div id="{%= id %}" class="customer-view">
                <div class="detail-container">
                    <div class="section clearfix">
                        <!-- Header -->
                        <div class="header">
                            <div class="test-object-badge" title="Test Customer"></div>
                            <div class="title">
                                <h2 class="email">
                                    <strong data-text="{%= email %}">{%= email %}</strong>
                                    <span>{%= id %}</span>
                                </h2><!---->
                            </div>
                        </div>
                        <!-- Content -->
                        <div class="content">
                            <div class="gradient"></div>
                            <!-- Details -->
                            <div class="section-wrap">
                                <h3>Customer Details</h3>
                                <div class="container">
                                    <dl class="dl-horizontal">
                                        <dt>ID:</dt>
                                        <dd>{%= id %}</dd>
                                        
                                        <dt>Name:</dt>
                                        <dd class="edit_details">{%= card.name %}</dd>
                
                                        <dt>Email:</dt>
                                        <dd class="edit_details">{%= email %}</dd>
                
                                        <dt>Description:</dt>
                                        <dd class="edit_details"><em>{%= description %}</em></dd>

                                        <dt>Address:</dt>
                                        <dd class="edit_details">
                                            <p>{%= card.address_line1 %}</p>
                                            {% if (card.address_line2){ %}<p>{%= card.address_line2 %}</p>{% } %}
                                            <p>
                                                {%= card.address_zip %},
                                                {%= card.address_city %},
                                                {%= card.address_state %},
                                                {%= card.address_country %}
                                            </p>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
            
                            <!-- Invoices -->
                            <div class="section-wrap" id="customer-invoices">
                                <h3>Invoices</h3>
                                <div class="container invoices sublist">
                        
                                    <!-- Loading state -->
                                    <div class="loading" style="display: none;">
                                      <em class="empty-container">Loading invoice information...</em>
                                    </div>
                        
                                    <!-- There are invoices -->
                                    <div class="many">
                                        <ul>
                                            {% _.each(invoices.data, function(invoice) { %}
                                                <li>
                                                    <a data-model-id="{%= invoice.id %}" href="/test/invoices/{%= invoice.id %}" class="unpaid">
                                                        <span class="date">{%= invoice.date %}</span>
                                                
                                                        <strong>${%= invoice.amount_due %}</strong>
                                                        <em>— {%= invoice.id %}</em>
                                                        
                                                          <em>— Billed from {%= invoice.subscription %}</em>
                                                        
                                                    </a>
                                                </li>
                                            {% }); %}
                                        </ul>
                        
                                        <p class="more" style="display: none;">
                                            <a href="/test/invoices?customer={%= id %}">
                                                View more invoices
                                            </a>
                                        </p>
                                    </div>
                        
                                    <!-- No invoices -->
                                    <div class="none" style="display: none;">
                                        <em class="empty-container">No invoices</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        
    </script>


</body>
</html>
